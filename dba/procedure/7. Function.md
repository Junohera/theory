[toc]

# Function

input value와 output value의 관계를 정의하는 객체
input value는 생략될 수 있고, 다수 전달 가능(default 값 선언 가능)

## syntax

```sql
-- define
create [or replace] function FUNCTION_NAME
	(input_value1		data_type	[:=value	|	default value]],
   input_value2		data_type	[:=value	|	default value]],
   ...
  )
  return data_type
is
	pl/sql block
	return 변수명
/

-- call
select function_name(input)
  from dual;  
```

## Tutorial

### case 1) create function

```sql
create or replace function get_today
return char
is
  result char(19);
  begin
    select to_char(sysdate, 'YYYY-MM-DD HH24:MI:SS')
      into result
      from dual;
      
    return result;
  end;
/

select object_name,
       object_type
  from user_procedures
 where object_type = 'FUNCTION';
desc get_today;

select get_today()
  from dual;
```

### case 2) 입력받은 부서번호에 해당하는 최대급여를 반환

```sql
create or replace function get_max_sal_by_department
(ideptno scott.emp.deptno%type)
return number
is
  max_sal scott.emp.sal%type;
  begin
    select max(sal) into max_sal
      from emp
     where deptno = ideptno;
    return max_sal;
  end;
/

select get_max_sal_by_department(10)
  from dual;
select ename, sal, deptno, get_max_sal_by_department(deptno)
  from emp
 where sal = get_max_sal_by_department(deptno);
```

### case 3) 입력받은 학번에 해당하는 학점 반환

```sql
create or replace function get_hakjum_by_studno
(istudno scott.student.studno%type)
return scott.hakjum.grade%type
is
	vhakjum	scott.hakjum.grade%type;
	begin
		select (select grade 
              from hakjum 
             where (select total 
                      from exam_01 
                     where studno = s.studno) between min_point
            																		  and max_point) 
		  into vhakjum
		  from student s
		 where s.studno = istudno;
		return vhakjum;
	end;
/

select object_name,
       object_type
  from user_procedures
 where 1=1
   and object_type = 'FUNCTION'
   and object_name like '%HAKJUM%';
desc get_hakjum_by_studno;
select get_hakjum_by_studno(9411)
  from dual;
```

### case 4) 고객이 가져갈 수 있는 최대 상품을 출력할 수 있는 함수작성 후, 고객 조회(gogak, gift)

```sql
create or replace function get_max_gift
(igno scott.gogak.gno%type)
return varchar2
is
  gname scott.gift.gname%type;
  begin
    select gf.gname
      into gname
      from gogak gg, gift gf
     where gg.point between gf.g_start and gf.g_end
       and gg.gno = igno;
    return gname;
  end;
/
select g.*, get_max_gift(gno)
  from gogak g;
```




# Export - Tablespace

## ê²°ê³¼

| tablespace migration | case 1 | case 2 | case 3 | case 4 | case 5                                                       |
| -------------------- | ------ | ------ | ------ | ------ | ------------------------------------------------------------ |
| tablespace           | X      | X      | O      | O      | O                                                            |
| user                 | X      | O      | O      | O      | FROM_USER<br />TO_USER                                       |
| granted_user         | X      | X      | X      | O      | x                                                            |
| tables               | âŒ      | âŒ      | âœ…      | âœ…      | âœ…                                                            |
| constraints          | âŒ      | âŒ      | âœ…      | âœ…      | âœ…                                                            |
| indexes              | âŒ      | âŒ      | âœ…      | âœ…      | âœ…                                                            |
| data                 | âŒ      | âŒ      | âŒ      | âŒ      | âœ…                                                            |
| note                 |        |        |        |        | ì‚¬ì‹¤ userë‹¨ìœ„ë¡œ ê°€ëŠ”ê²ƒì´ë¯€ë¡œ, default tablespaceë¡œ ì´ë™ë˜ë©°, ë˜í•œ dbaê¶Œí•œì´ í•„ìš”í•¨. |

## ê²°ë¡ 

> í…Œì´ë¸”ìŠ¤íŽ˜ì´ìŠ¤ ë‹¨ìœ„ì˜ ì´ê´€ì˜ ê²½ìš°,
>
> 1. í…Œì´ë¸” ìŠ¤íŽ˜ì´ìŠ¤ ìƒì„±(ë¬¼ë¦¬ì ì¸ ë°ì´í„°íŒŒì¼ í•„ìš”)
> 2. ìœ ì € ìƒì„±

```sql
-- í…Œì´ë¸” ìƒì„±
drop tablespace test_tablespace including contents;
create tablespace test_tablespace datafile '/oracle12/app/oracle/oradata/db1/test_tablespace_01.dbf' size 50m;
-- ìœ ì € ìƒì„±
drop user tbs cascade;
drop user tbs_another cascade;
create user tbs identified by oracle
default tablespace test_tablespace
quota unlimited on test_tablespace
quota 50m on system;
grant create session to tbs;
grant create synonym to tbs;
create user tbs_another identified by oracle;
grant create session to tbs_another;

-- í…Œì´ë¸” ìƒì„±
create table tbs.test_tablespace1 (no number, name varchar2(10));
insert into tbs.test_tablespace1
select 1, 'a' from dual
 union all
select 2, 'b' from dual
 union all
select 3, 'c' from dual;
commit;
create table tbs.test_tablespace2 as select * from tbs.test_tablespace1;
create table tbs.test_tablespace3 as select * from tbs.test_tablespace1;
select * from tbs.test_tablespace1;
select * from tbs.test_tablespace2;
select * from tbs.test_tablespace3;

-- ì œì•½ì¡°ê±´ ìƒì„±
alter table tbs.test_tablespace1 add constraint pk_test_tablespace1_no primary key (no);
alter table tbs.test_tablespace2 add constraint pk_test_tablespace2_no primary key (no);
alter table tbs.test_tablespace3 add constraint pk_test_tablespace3_no primary key (no);

-- ì¸ë±ìŠ¤ ìƒì„±
create index tbs.idx_test_tablespace1_name on tbs.test_tablespace1(name);
create index tbs.idx_test_tablespace2_name on tbs.test_tablespace2(name);
create index tbs.idx_test_tablespace3_name on tbs.test_tablespace3(name);

-- at tbs session
-- ì‹œë…¸ë‹˜ ìƒì„±
drop synonym tt1;
drop synonym tt2;
drop synonym tt3;

create synonym tt1 for tbs.test_tablespace1;
create synonym tt2 for tbs.test_tablespace2;
create synonym tt3 for tbs.test_tablespace3;

-- ê¶Œí•œ ë¶€ì—¬
grant select on tbs.test_tablespace1 to tbs_another;
grant select on tbs.test_tablespace2 to tbs_another;
grant select on tbs.test_tablespace3 to tbs_another;

-- at tbs_another session
select * from tbs.test_tablespace1;
select * from tbs.test_tablespace2;
select * from tbs.test_tablespace3;
select * from tt1;
select * from tt2;
select * from tt3;
```

í…Œì´ë¸”ìŠ¤íŽ˜ì´ìŠ¤ ë‹¨ìœ„ export

```shell
exp system/oracle file=exp_test_tablespace.dmp tablespaces=test_tablespace
```

1. tablespace:X, user:X, granted_user: X

```sql
imp system/oracle@green_db1 file=exp_test_tablespace.dmp log=exp_test_tablespace.log tablespaces=test_tablespace full=y

"ALTER SESSION SET CURRENT_SCHEMA= "TBS""
IMP-00003: ORACLE error 1435 encountered
ORA-01435: user does not exist
IMP-00000: Import terminated unsuccessfully

=> nothing...
```

2. tablespace:X, user:O, granted_user: X

```sql
create user tbs identified by oracle;

imp system/oracle@green_db1 file=exp_test_tablespace.dmp log=exp_test_tablespace.log tablespaces=test_tablespace full=y

=> nothing...
```

3. tablespace:O, user: O, granted_user: X

```sql
create tablespace test_tablespace datafile '/oracle12/app/oracle/oradata/db1/test_tablespace_01.dbf' size 50m;
create user tbs identified by oracle;

imp system/oracle@green_db1 file=exp_test_tablespace.dmp log=exp_test_tablespace.log tablespaces=test_tablespace full=y

=> table, constraints, indexes
=> no data
```

4. tablespace: O, user: O, granted_user: O

```sql
create tablespace test_tablespace datafile '/oracle12/app/oracle/oradata/db1/test_tablespace_01.dbf' size 50m;
create user tbs identified by oracle;
create user tbs_another identified by oracle;

imp system/oracle@green_db1 file=exp_test_tablespace.dmp log=exp_test_tablespace.log tablespaces=test_tablespace full=y

=> table, constraints, indexes
=> no data
```

5. tablespace: O, from ðŸ’™.tbs to ðŸ’š.scott

```sql
create tablespace test_tablespace datafile '/oracle12/app/oracle/oradata/db1/test_tablespace_01.dbf' size 50m;

imp system/oracle@green_db1 file=exp_test_tablespace.dmp log=exp_test_tablespace.log tablespaces=test_tablespace fromuser=tbs touser=scott

=> table, constraints, indexes, data
=> but tablespace is default tablespace of touser, required dba permission
```




[toc]

# Exception

## Type

### Predefined

oracleÏóê Ï†ïÏùòÎêòÏñ¥ ÏûàÎäî exception

```sql
exception
	when NO_DATA_FOUND then
	-- when accur exception
```

### Non-Predefined

oracleÏóê Ï†ïÏùòÎêòÏñ¥ ÏûàÏßÄ ÏïäÏßÄÎßå,
ExceptionÍ≥º Ïò§Î•òÎ≤àÌò∏Î•º Í≤∞Ìï©ÌïòÏó¨ oracle exceptionÌÉÄÏûÖÏúºÎ°ú ÎûòÌïëÌïòÏó¨ ÏÇ¨Ïö©ÌïòÎäî ÌòïÌÉú

```sql
declare
  no_student    exception;
  pragma exception_init (no_student, -???);
...
exception
	when no_student then
	-- when accur exception
```

### User defined

ÏÇ¨Ïö©ÏûêÍ∞Ä ÏßÅÏ†ë Ï†ïÏùòÌïú exception

#### raise (‚úÖ)

Î™©Ï†Å: Ï†ïÏÉÅ Ï¢ÖÎ£å

Ïã§ÌñâÏ†àÏóêÏÑú exception codeÎ•º Ï†ïÏùòÌïòÍ≥†
ÏòàÏô∏Ï≤òÎ¶¨Î∂ÄÏóêÏÑú Ï†ïÏùòÎêú exception codeÏùò Î©îÏãúÏßÄÎ•º Ï∂úÎ†•
ÎåÄÏã†, exception codeÎäî exception Îç∞Ïù¥ÌÑ∞ÌÉÄÏûÖ ÏÑ†Ïñ∏ ÌïÑÏöî

```sql
declare
  no_student    exception;
begin
  raise no_student;
exception 
  when no_student then
  dbms_output.put_line('ÏßÄÎèÑÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§');
end;
/
```

#### raise_application_error(‚ùå)

Î™©Ï†Å: ÎπÑÏ†ïÏÉÅ Ï¢ÖÎ£å

Ïã§ÌñâÏ†àÏóêÏÑú Î∞îÎ°ú ÏóêÎü¨ Ï≤òÎ¶¨(ÎπÑÏ†ïÏÉÅ Ï¢ÖÎ£å, ora codeÎ•º ÏßÄÏ†ïÌï† Ïàò ÏûàÏùå)
** ora code: 20000~20999 ÏÇ¨Ïö©Í∞ÄÎä•ÌïòÍ≥†, ÎßàÏπò Ïò§ÎùºÌÅ¥ ÏóêÎü¨Ï≤òÎüº ÏÇ¨Ïö© Í∞ÄÎä•

```sql
declare
  no_student    exception;
begin
 	raise_application_error(-20100, 'ÏßÄÎèÑÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§.');
end;
/
```

## Tutorial

> Îçî Ïù¥ÏÉÅ Ï∂úÎ†•Ìï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞, ORA ÏóêÎü¨ Î∞úÏÉùÏ≤òÎ¶¨Î•º
> ÏÇ¨Ïö©ÏûêÍ∞Ä ÏßÄÏ†ïÌïú Î©îÏãúÏßÄÍ∞Ä Ï∂úÎ†•ÎêòÎ©¥ÏÑú Ï†ïÏÉÅ ÌîÑÎ°úÏãúÏ†∏Î•º Ï¢ÖÎ£åÏãúÌÇ¥
>
> emp ÌÖåÏù¥Î∏îÏóêÏÑú ÏÇ¨ÏõêÎ≤àÌò∏Î•º ÏûÖÎ†•Î∞õÍ≥†,
> ÏÉÅÏúÑÍ¥ÄÎ¶¨Ïûê Ïù¥Î¶ÑÍ≥º ÏÉÅÏúÑÍ¥ÄÎ¶¨ÏûêÏôÄÏùò Í∏âÏó¨Ï∞®Î•º ÏïÑÎûòÏôÄ Í∞ôÏùÄ ÌòïÏãùÏúºÎ°ú Ï∂úÎ†•
>
> Í¥ÄÎ¶¨Ïûê: scott, Í∏âÏó¨Ï∞®: 400

### case 1) Predefined exception

```sql
declare
  mgr_name  scott.emp.ename%type;
  gap       scott.emp.sal%type;
  
--  iempno scott.emp.empno%type := 7369; 	-- ‚úÖ
  iempno scott.emp.empno%type := 9999; 		-- üí• no empno 	=> NO_DATA_FOUND
--  iempno scott.emp.empno%type := 7839; 	-- üí• no mgr		=> NO_DATA_FOUND
begin
  select e2.ename,
         abs(e2.sal - e1.sal)
    into mgr_name, gap
    from scott.emp e1, scott.emp e2
   where 1=1
     and e1.mgr = e2.empno
     and e1.empno = iempno;
  
  dbms_output.put_line('Í¥ÄÎ¶¨Ïûê: '||mgr_name||', Í∏âÏó¨Ï∞®: '||gap);
  
exception
	when NO_DATA_FOUND then
  dbms_output.put_line('Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏóÜÍ±∞ÎÇò Ìï¥Îãπ ÏßÅÏõêÏù¥ Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
end;
/
```

### case 2) Non-Predefined Exception

```sql
declare
--  vno           number := 1001;		-- ‚úÖ
  vno           number := 4004;			-- üí• => raise no_student
  
  pname         scott.professor.name%type;
  std_cnt       number;
  no_student    exception;
  pragma exception_init (no_student, -21000);
begin
  select p.name, count(s.studno) into pname, std_cnt
    from professor p, student s
   where p.profno = s.profno(+)
     and p.profno = vno
   group by p.profno, p.name;
   
  if std_cnt = 0 then
    raise no_student;
  end if;
    
  dbms_output.put_line(pname||'Ïùò ÏßÄÎèÑÌïôÏÉùÏùÄ '||std_cnt||'Î™ÖÏûÖÎãàÎã§.');
  
exception 
  when no_student then
  dbms_output.put_line('ÏßÄÎèÑÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§');
end;
/
```

### case 3) User defined Exception

> student, professor ÌÖåÏù¥Î∏îÏóêÏÑú Ïù¥Ïö©ÌïòÏó¨
> ÏûÖÎ†•Î∞õÏùÄ ÏßÄÎèÑÍµêÏàò Î≤àÌò∏Ïóê Ìï¥ÎãπÌïòÎäî ÏßÄÎèÑÌïôÏÉù ÏàòÎ•º Ï∂úÎ†•
> format: ÎÇòÌïúÏó¥Ïùò ÏßÄÎèÑÌïôÏÉùÏùÄ 1Î™ÖÏûÖÎãàÎã§.
> Îã®, ÏßÄÎèÑÌïôÏÉùÏù¥ ÏóÜÎäî Í≤ΩÏö∞Îäî ÏóêÎü¨Ï≤òÎ¶¨(ÏßÄÎèÑ ÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§.)

#### raise

```sql
declare
--  vno           number := 1001;		-- ‚úÖ
  vno           number := 4004;			-- üí• => raise no_student
  
  pname         scott.professor.name%type;
  std_cnt       number;
  no_student    exception;
begin
  select p.name, count(s.studno) into pname, std_cnt
    from professor p, student s
   where p.profno = s.profno(+)
     and p.profno = vno
   group by p.profno, p.name;
   
  if std_cnt = 0 then
    raise no_student;
  end if;
    
  dbms_output.put_line(pname||'Ïùò ÏßÄÎèÑÌïôÏÉùÏùÄ '||std_cnt||'Î™ÖÏûÖÎãàÎã§.');
  
exception 
  when no_student then
  dbms_output.put_line('ÏßÄÎèÑÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§');
end;
/
```

#### raise_application_error

```sql
declare
--  vno           number := 1001;		-- ‚úÖ
  vno           number := 4004;			-- üí• => raise no_student
  
  pname         scott.professor.name%type;
  std_cnt       number;
begin
  select p.name, count(s.studno) into pname, std_cnt
    from professor p, student s
   where p.profno = s.profno(+)
     and p.profno = vno
   group by p.profno, p.name;
   
  if std_cnt = 0 then
  	raise_application_error(-20100, 'ÏßÄÎèÑÌïôÏÉùÏù¥ ÏóÜÏäµÎãàÎã§.');
  end if;
    
  dbms_output.put_line(pname||'Ïùò ÏßÄÎèÑÌïôÏÉùÏùÄ '||std_cnt||'Î™ÖÏûÖÎãàÎã§.');
end;
/
```

## üéÅ oracle exception code

TODO: ÏÑ§Î™ÖÏπ∏ Î≤àÏó≠ÏúºÎ°ú 

| Exception name          | Oracle Database error number | Description                                                  | is support timesten |
| ----------------------- | ---------------------------- | ------------------------------------------------------------ | ------------------- |
| DUP_VAL_ON_INDEX        | ORA-00001                    | Program attempted to insert duplicate values in a column that is constrained by a unique index. | Y                   |
| TIMEOUT_ON_RESOURCE     | ORA-00051                    | Timeout occurred while the database was waiting for a resource. | üí•                   |
| INVALID_CURSOR          | ORA-01001                    | There is an illegal cursor operation.                        | Y                   |
| NOT_LOGGED_ON           | ORA-01012                    | Program issued a database call without being connected to the database. | üí•                   |
| LOGIN_DENIED            | ORA-01017                    | User name or password is invalid.                            | üí•                   |
| NO_DATA_FOUND           | ORA-01403                    | Single row SELECT returned no rows or your program referenced a deleted element in a nested table or an uninitialized element in an associative array (index-by table). | Y                   |
| SYS_INVALID_ROWID       | ORA-01410                    | The conversion of a character string into a universal rowid failed because the character string does not represent a ROWID value. | Y                   |
| TOO_MANY_ROWS           | ORA-01422                    | Single row SELECT returned multiple rows.                    | Y                   |
| ZERO_DIVIDE             | ORA-01476                    | A program attempted to divide a number by zero.              | Y                   |
| INVALID_NUMBER          | ORA-01722                    | Conversion of character string to number failed.             | Y                   |
| STORAGE_ERROR           | ORA-06500                    | PL/SQL ran out of memory or memory was corrupted.            | Y                   |
| PROGRAM_ERROR           | ORA-06501                    | PL/SQL has an internal problem.                              | Y                   |
| VALUE_ERROR             | ORA-06502                    | An arithmetic, conversion, truncation, or size constraint error occurred. | Y                   |
| ROWTYPE_MISMATCH        | ORA-06504                    | Host cursor variable and PL/SQL cursor variable involved in an assignment statement have incompatible return types. | Y                   |
| CURSOR_ALREADY_OPENED   | ORA-06511                    | Program attempted to open an already opened cursor.          | Y                   |
| ACCESS_INTO_NULL        | ORA-06530                    | Program attempted to assign values to the attributes of an uninitialized object. | Y                   |
| COLLECTION_IS_NULL      | ORA-06531                    | Program attempted to apply collection methods other than EXISTS to an uninitialized nested table or varray, or program attempted to assign values to the elements of an uninitialized nested table or varray. | Y                   |
| SUBSCRIPT_OUTSIDE_LIMIT | ORA-06532                    | A program referenced a nested table or varray element using an index number that is outside the legal range (for example, -1). | Y                   |
| SUBSCRIPT_BEYOND_COUNT  | ORA-06533                    | A program referenced a nested table or varray using an index number larger than the number of elements in the collection. | Y                   |
| CASE_NOT_FOUND          | ORA-06592                    | None of the choices in the WHEN clauses of a CASE statement were selected and there is no ELSE clause. | Y                   |
| SELF_IS_NULL            | ORA-30625                    | Program attempted to invoke a MEMBER method, but the object was not initialized. | üí•                   |
| OTHERS                  |                              |                                                              |                     |


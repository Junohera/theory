[toc]

# Cursor

> `OPEN => FETCH => CLOSE`
> ì˜¤ë¼í´ì€ sql ë¬¸ì¥ì´ ì‹¤í–‰ë˜ë©´ íŒŒì‹±ì„ ê±°ì³ ë°ì´í„°ë¥¼ ë²„í¼ìºì‹œì— ì˜¬ë ¤ë‘ëŠ”ë°
> ì´ ë•Œ, ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê¸° ìœ„í•´ ë²„í¼ìºì‹œ ë‚´ìš©ì„ PGAì— ë³µì‚¬í•œ ë’¤
> ê°œë³„ì ì¸ ë©”ëª¨ë¦¬ ê³µê°„ì„ í• ë‹¹í•˜ì—¬ ì—¬ê¸°ì„œ ë°ì´í„°ë¥¼ ì •ë¦¬í•˜ì—¬ fetch
> ì´ ë•Œì˜ ë©”ëª¨ë¦¬ ê³µê°„ì„ ì»¤ì„œë¼ í•¨.

## Type

### Implicit cursor

> ë¬µì‹œì  ì»¤ì„œ: oracleì´ ìë™ìœ¼ë¡œ ì„ ì–¸í•˜ê³  ì‚¬ìš©í•˜ëŠ” ì»¤ì„œ

| key          | value             |
| ------------ | ----------------- |
| SQL%ROWCOUNT | total row count   |
| SQL%FOUND    | is exist next     |
| SQL%NOTFOUND | is not exist next |
| SQL%ISOPEN   | is still open     |

### Explicit cursor

> ëª…ì‹œì  ì»¤ì„œ: ì‚¬ìš©ì ì •ì˜ ì»¤ì„œ
> `define -> open -> fetch -> close`

## Tutorial

> empì—ì„œ ê° ì§ì›ì˜ ì •ë³´ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥í•˜ë¼.
> SMITHì˜ 10% ì¸ìƒëœ ê¸‰ì—¬ëŠ” 880ì…ë‹ˆë‹¤.

### errorğŸ’¥

```sql
declare
  vname   scott.emp.ename%type;
  vsal    scott.emp.sal%type;
begin
  select ename, sal into vname, vsal
    from scott.emp;
    
  dbms_output.put_line(vname||'ì˜ 10% ì¸ìƒëœ ê¸‰ì—¬ëŠ” '||(vsal * 1.1)||'ì…ë‹ˆë‹¤.');
end;
/

ORA-01422: ì‹¤ì œ ì¸ì¶œì€ ìš”êµ¬ëœ ê²ƒë³´ë‹¤ ë§ì€ ìˆ˜ì˜ í–‰ì„ ì¶”ì¶œí•©ë‹ˆë‹¤ ORA-06512:  5í–‰
```

### loopğŸ˜‚

```sql
declare
  vname   scott.emp.ename%type;
  vsal    scott.emp.sal%type;
  
	cursor c1 is
    select ename, sal
      from scott.emp
     order by empno;
begin
  open c1;
  
  loop
    fetch c1 into vname, vsal;  
    exit when c1%notfound;
    dbms_output.put_line(vname||'ì˜ 10% ì¸ìƒëœ ê¸‰ì—¬ëŠ” '||(vsal * 1.1)||'ì…ë‹ˆë‹¤.');
  end loop;  
end;
/
```

### forğŸ˜ƒ

>loopê³¼ ë‹¬ë¦¬ ë¶ˆí•„ìš”í•œ ë¬¸ë²•ë“¤ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ì •ìƒ ì‘ë™í•œë‹¤.
>ì´ëŠ” forë¬¸ì— open fetch closeê°€ í¬í•¨ë˜ì–´ìˆê¸° ë•Œë¬¸ì´ê³ ,
>ì–´ë–¤ ì–¸ì–´ì—ë„ ì´ ê°œë…ì´ ë™ì¼í•˜ê²Œ ì ìš©ë˜ì–´ ìˆë‹¤.

#### predefine cursor

```sql
declare
  cursor sp is
    select s.name, nvl(p.name, 'ì§€ë„êµìˆ˜ì—†ìŒ') as pname
      from student s, professor p
     where s.profno = p.profno(+);
begin
  for i in sp loop
    dbms_output.put_line('í•™ìƒëª…: '||i.name||', ì§€ë„êµìˆ˜ëª…: '||i.pname);
  end loop;
end;
/
```

#### immediate cursor

```sql
begin
  for i in (select s.name, nvl(p.name, 'ì§€ë„êµìˆ˜ì—†ìŒ') as pname
              from student s, professor p
             where s.profno = p.profno(+))
  loop
    dbms_output.put_line('í•™ìƒëª…: '||i.name||', ì§€ë„êµìˆ˜ëª…: '||i.pname);
  end loop;
end;
/
```




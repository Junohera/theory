[toc]

#  Manange Undo tablespace

## 조회

### summary

```sql
# in prompt
SQL> show parameter undo_tablespace;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
undo_tablespace                      string      UNDOTBS1

# in client
select *
  from v$parameter
 where name = 'undo_tablespace';
```

### size 

```sql
select TABLESPACE_NAME, 
       sum(BYTES)/1024/1024 as "BYTES(MB)"
  from dba_data_files
 where TABLESPACE_NAME in (select value
                             from v$parameter
                            where name = 'undo_tablespace')
 group by TABLESPACE_NAME;
 
 TABLESPACE_NAME                 BYTES(MB)
------------------------------ ----------
UNDOTBS1                              335
```

### using undo extent

```sql
# just by tablespace_name
select TABLESPACE_NAME,
       sum(BYTES)/1024/1024 as "bytes(MB)",
       sum(BLOCKS) as "block count"
  from dba_undo_extents
 where TABLESPACE_NAME in (select value
                             from v$parameter
                            where name = 'undo_tablespace')
 group by TABLESPACE_NAME;
 
 TABLESPACE_NAME                 bytes(MB) block count
------------------------------ ---------- -----------
UNDOTBS1                          18.1875        2328
```

### using undo extent by status

```sql
# by tablespace_name, status
select TABLESPACE_NAME,
       STATUS,
       sum(BYTES)/1024/1024 as "bytes(MB)",
       sum(BLOCKS) as "block count"
  from dba_undo_extents
 where TABLESPACE_NAME in (select value
                             from v$parameter
                            where name = 'undo_tablespace')
 group by TABLESPACE_NAME, STATUS;
 
 TABLESPACE_NAME                STATUS     bytes(MB) block count
------------------------------ --------- ---------- -----------
UNDOTBS1                       UNEXPIRED     6.1875         792
UNDOTBS1                       EXPIRED           11        1408
UNDOTBS1                       ACTIVE             1         128
```

```shell
UNEXPIRED: 트랜잭션 종료되었지만, RETENTION까지 지나지 않은 세그먼트 -> unavailable segment
EXPIRED: 트랜잭션 종료되었지만, RETENTION까지 지난 세그먼트 -> available segment
ACTIVE: 트랜잭션이 종료되지 않은 세그먼트 -> unavailable segment
```


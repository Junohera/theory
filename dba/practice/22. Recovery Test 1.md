# Recovery Test 1

```shell
. ~/.bash_profile

echo "ë³µêµ¬ ì‘ì—…ì„ ìœ„í•œ ì „ì²´ ë°±ì—… ìˆ˜í–‰ì¤‘..."
find /oracle12/backup -name "control*.ctl" -type f  -exec rm -f {} \; 2>/dev/null
find /oracle12/backup -name "*.dbf" -type f  -exec rm -f {} \; 2>/dev/null
find /oracle12/backup -name "redo*" -type f  -exec rm -f {} \; 2>/dev/null
find /oracle12/backup -name "con*sql" -type f  -exec rm -f {} \; 2>/dev/null
find /home -name "control*.ctl" -type f  -exec rm -f {} \; 2>/dev/null
find /home -name "*.dbf" -type f  -exec rm -f {} \; 2>/dev/null
find /home -name "redo*" -type f  -exec rm -f {} \; 2>/dev/null
find /home -name "con*sql" -type f  -exec rm -f {} \; 2>/dev/null

sqlplus -s /nolog << _EOF_ > /dev/null
conn / as sysdba
set head off
set lines 10000
set pages 10000
set feedback off
set echo off
set term off

spool /oracle12/abc.sh

select 'mkdir -p /oracle12/backup/'||to_char(sysdate,'yyyymmdd') from dual
union all
select 'cp '||name||' /oracle12/backup/'||to_char(sysdate,'yyyymmdd')||'/'||substr(name,instr(name,'/',-1,1)+1) as "copy ddl"
  from v\$datafile
 union all
select 'cp '||name||' /oracle12/backup/'||to_char(sysdate,'yyyymmdd')||'/'||substr(name,instr(name,'/',-1,1)+1) as "copy ddl"
  from v\$controlfile
 union all  
select 'cp '||member||' /oracle12/backup/'||to_char(sysdate,'yyyymmdd')||'/'||substr(member,instr(member,'/',-1,1)+1) as "copy ddl"
  from v\$logfile
/

spool off

spool /oracle12/abcc.sh

!mkdir -p /oracle12/datapump

select 'tar -cvf /oracle12/datapump/backup_hong.tar '||substr(file_name,1,instr(file_name,'/',-1,1)-1)||'/*'
 from dba_data_files
where tablespace_name ='SYSTEM'
/

spool off

shutdown immediate
_EOF_

sh -x /oracle12/abc.sh
sh -x /oracle12/abcc.sh

echo "í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì„± ì¤‘..."

sqlplus -s /nolog << _EOF_ > /dev/null
conn / as sysdba
set head off
set lines 10000
set pages 10000
set feedback off
set echo off
set term off

startup

alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/

# itwill_ts í…Œì´ë¸” ìŠ¤í˜ì´ìŠ¤ ìƒì„± ì „ ë°ì´í„° íŒŒì¼ ì‚­ì œ
spool /oracle12/datafile_rm.sql

select '!rm ' || file_name
 from dba_data_files
where tablespace_name ='ITWILL_TS'
/

spool off

@/oracle12/datafile_rm.sql

# test tablespace ìƒì„±
select 'create tablespace itwill_ts datafile '''||substr(file_name,1,instr(file_name,'/',-1,1)-1)||'/itwill.dbf'''|| ' size 50m;'
 from dba_data_files
where tablespace_name ='SYSTEM'
/

spool off



spool /oracle12/abcd.sql

select 'create tablespace itwill_ts datafile '''||substr(file_name,1,instr(file_name,'/',-1,1)-1)||'/itwill.dbf'''|| ' size 50m;'
 from dba_data_files
where tablespace_name ='SYSTEM'
/

spool off

@/oracle12/abcd.sql

alter user scott quota unlimited on itwill_ts
/

create table scott.itwill_test1(a varchar2(20)) tablespace itwill_ts
/

insert into scott.itwill_test1 values('a')
/
commit
/

alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/

insert into scott.itwill_test1 values('b')
/
commit
/

alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/
alter system switch logfile
/

spool /oracle12/abcde.sql

select '! rm -f ' ||file_name
  from dba_data_files
 where tablespace_name like 'itwill%'
union all
select '! rm -f ' ||name
  from v\$controlfile
/

spool off

@/oracle12/abcde.sql

insert into scott.itwill_test1 values('recover success')
/
commit
/

shutdown abort

_EOF_

rm -f /oracle12/abc*

echo "ì¥ì•  ìƒí™© ë°œìƒ : DB shutdown ìƒí™©!!"
echo 'ë³µêµ¬ ì™„ë£Œ í›„ scott.itwill_test1 í…Œì´ë¸”ì„ ì¡°íšŒí•˜ì—¬ë¼(ì´3ê±´)'
```

```sql
tail -f alert
startup open

ğŸ’¥controlfile not found
vi ${ORACLE_HOME}/dbs/initdb1.ora

1. parameter í™˜ê²½ ì¡°íšŒ
show parameter pfile;
2. parameteríŒŒì¼ ì‹œê°„ì°¨ì´ í™•ì¸
	pfile vs spfile ì‹œê°„ì°¨ì´ í™•ì¸í•˜ì—¬ ì˜¤ë˜ë˜ì—ˆë‹¤ë©´ ë¯¿ì§€ë§ê³  ë§Œë“¤ì
3. create pfile from spfile;
4. init${ORACLE_SID}.oraë¥¼ vië¥¼ í†µí•´ ì—´ì–´ë³¸ í›„ controlfile ìœ„ì¹˜ í™•ì¸
5. controlfile ì¡´ì¬ í™•ì¸
6. ì»¨íŠ¸ë¡¤íŒŒì¼ íŒë‹¨
	a. backup controlfileì´ ìµœì‹ ì¼ ê²½ìš°, ì¬ìƒì„±âœ…
	b. backup controlfileì´ ì˜¤ë˜ë˜ì—ˆê±°ë‚˜ ì—†ì„ ê²½ìš° old controlfileì„ ë¦¬ì»¤ë²„ë¦¬âœ…
7. ë³µêµ¬ë°©ì‹ íŒë‹¨
	archiveëª¨ë“œì´ë©´ì„œ redoì™€ archive log fileì´ ì •ìƒìœ¼ë¡œ íŒë‹¨ëœë‹¤ë©´ ìš°ì„  ì™„ì „ë³µêµ¬ë¥¼ ì§„í–‰í•´ë³¸ë‹¤.
	archiveëª¨ë“œê°€ ì•„ë‹ˆê±°ë‚˜ redoê°€ 
	
```


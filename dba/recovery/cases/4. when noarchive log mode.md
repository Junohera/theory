# When noarchive log mode

> offline full bakcup이 선행되어있어야만 가능

## Setting

### 1. archive log mode to noarchive log mode

```sql
startup mount;
alter database noarchivelog;
alter database open;
archive log list;
```

```sql
SQL> startup mount
Database mounted.
SQL> alter database noarchivelog;
Database altered.
SQL> alter database open;
Database altered.
SQL> archive log list;
Database log mode              No Archive Mode
Automatic archival             Disabled
```

---

### 2. offline full backup

```sql
SQL> !mkdir /oracle12/backup
SQL> alter database backup controlfile to trace as '/oracle12/backup/control.sql';
vi /oracle12/backup/control.sql
SQL> shutdown immediate;

backupdir=/opt/backup4oracle12/backup_$(date +"%Y%m%d%H%M")
echo $backupdir

mkdir -p $backupdir
cp /oracle12/backup/control.sql $backupdir
cp /oracle12/app/oracle/oradata/db1/* $backupdir
cp /oracle12/app/oracle/product/12.2.0.1/db_1/dbs/*.ora $backupdir

cd $backupdir;ll;
total 2751240
-rw-r-----. 1 oracle oinstall  10600448 Jul 20 11:46 control01.ctl
-rw-r-----. 1 oracle oinstall  10600448 Jul 20 11:46 control02.ctl
-rw-r--r--. 1 oracle oinstall      1010 Jul 20 11:46 initdb1.ora
-rw-r--r--. 1 oracle oinstall      3079 Jul 20 11:46 init.ora
-rw-r-----. 1 oracle oinstall 209715712 Jul 20 11:46 redo01.log
-rw-r-----. 1 oracle oinstall 209715712 Jul 20 11:46 redo02.log
-rw-r-----. 1 oracle oinstall 209715712 Jul 20 11:46 redo03.log
-rw-r-----. 1 oracle oinstall      3584 Jul 20 11:46 spfiledb1.ora
-rw-r-----. 1 oracle oinstall 576724992 Jul 20 11:46 sysaux01.dbf
-rw-r-----. 1 oracle oinstall 734011392 Jul 20 11:46 system01.dbf
-rw-r-----. 1 oracle oinstall  20979712 Jul 20 11:46 temp01.dbf
-rw-r-----. 1 oracle oinstall 351281152 Jul 20 11:46 undotbs01.dbf
-rw-r-----. 1 oracle oinstall   5251072 Jul 20 11:46 users01.dbf

df

/opt/backup4oracle12/backup_202307251220
```

## Cases

|   no | noarchive log mode | Damage information |      |
| ---: | ------------------ | ------------------ | ---- |
|    1 | Yes                | normal tablespace  |      |
|      |                    |                    |      |
|      |                    |                    |      |

### 1. 일반 tablespace의 datafile 손상(when noarchivelogmode)

```sql
1. tablespace 확인
select *
  from dba_tablespaces;
  
2. 일반 tablespace 생성
select * from dba_data_files;
create tablespace test1
   			 datafile '/oracle12/app/oracle/oradata/db1/test1.dbf' size 10m;
   			 
3. offline backup

```


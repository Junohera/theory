[toc]

# Undo

## cases

| case | isDefaultUndo | archivelogmode | DB status | trouble shooting                                             | explain                                                      |
| ---: | ------------- | -------------- | --------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
|    1 | No            | Yes            | open      | 1ï¸âƒ£undo offline<br />2ï¸âƒ£recovery<br />3ï¸âƒ£open                      |                                                              |
|    2 | Yes           | Yes            | open      | 1ï¸âƒ£new undo<br />2ï¸âƒ£set default new undo<br />3ï¸âƒ£asis default undo offline \| offline immediate<br />4ï¸âƒ£recovery<br />5ï¸âƒ£open<br />6ï¸âƒ£rollback default(optional) | default undoì˜ ê²½ìš°, ì‚­ì œí•˜ë©´ ì•ˆë˜ë¯€ë¡œ<br />ìƒˆë¡œìš´ undoë¥¼ defaultë¡œ ë³€ê²½í•˜ê³ , ë¬¸ì œê°€ ë°œìƒí•œ asis default undoë¥¼ ì‚­ì œí•˜ê³ ,<br />ì´í›„ í•„ìš”ì— ë”°ë¼ ì›ë³µê³¼ì •ì„ ê±°ì¹˜ë©´ëœë‹¤. |
|      |               |                |           |                                                              |                                                              |

---

### 1. default undo ë¬¼ë¦¬ì  ì†ìƒ

```sql
1. default undo í™•ì¸
TODO: add default undo check 
select tablespace_name,
       file_name,
       status,
       autoextensible,
       online_status  
  from dba_data_files
 where tablespace_name = (select value
                            from v$parameter
                           where name = 'undo_tablespace');
 
|TABLESPACE_NAME|FILE_NAME                                     |STATUS   |AUTOEXTENSIBLE|ONLINE_STATUS|
|---------------|----------------------------------------------|---------|--------------|-------------|
|UNDOTBS1       |/oracle12/app/oracle/oradata/db1/undotbs01.dbf|AVAILABLE|YES           |ONLINE       |


2. ì¥ì•  ë°œìƒ
!rm /oracle12/app/oracle/oradata/db1/undotbs01.dbf

-- ë³µêµ¬ ì‹œë„
1. try offline
SQL> alter tablespace UNDOTBS1 offline;ğŸ’¥
SQL> alter tablespace UNDOTBS1 offline temporary;ğŸ’¥
SQL> alter tablespace UNDOTBS1 offline immediate;ğŸ’¥

2. restore 
cd /oracle12/app/oracle/oradata/db1
cp /opt/backup4oracle12/backup_202307261224/undotbs01.dbf ./

3. new undo
create undo tablespace undo_temp
         datafile '/oracle12/app/oracle/oradata/db1/undo_temp.dbf' size 100m;
            
4. set tobe default undo 
alter system set undo_tablespace = undo_temp;

5. try offline 
alter tablespace UNDOTBS1 offline;ğŸ’¥
alter tablespace UNDOTBS1 offline temporary;ğŸ’¥
alter tablespace UNDOTBS1 offline immediate;âœ…

6. recovery
recover tablespace UNDOTBS1

7. online
alter tablespace UNDOTBS1 online;

8. rollback asis default undo
alter system set undo_tablespace = UNDOTBS1;

9. drop tobe default undo
!rm /oracle12/app/oracle/oradata/db1/undo_temp.dbf
drop tablespace UNDO_TEMP;
```




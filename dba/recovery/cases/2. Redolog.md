[toc]

# Redolog

## case

### 1. member 삭제

각 그룹에 두개 이상의 member가 있는 상태에서 member하나에 손상 발생

해결. 멤버를 삭제 후 재생성(online)

```sql
[ 실습환경 구성 ]
1. 현재 리두로그 구성 확인
select a.group#
     , a.member
     , b.bytes/1024/1024 mb
     , b.sequence# "seq#"
     , b.status
     , b.archived arc
  from v$logfile a
     , v$log b
 where a.group# = b.group#
 order by 1, 2;
 
2. 멤버 추가
alter database add logfile member
			'/oracle12/app/oracle/oradata/db1/redo01_2.log' to group 1,
			'/oracle12/app/oracle/oradata/db1/redo02_2.log' to group 2,
			'/oracle12/app/oracle/oradata/db1/redo03_2.log' to group 3;
			
3. 장애 발생
inactive이면서, arc YES인 그룹 중 2번 멤버를 물리적으로 하나 삭제
(어차피 default 멤버는 삭제 불가)
rm /oracle12/app/oracle/oradata/db1/redo01_2.log

4. log switch
삭제한 멤버의 그룹이 current가 될 때까지 진행
alter system switch logfile;
=> ✨logswitch가 발생하면서 alert log에 해당 파일이 없음 기록되지만 DB운영에 문제가 없고, 장애난 group이 current가 되는것도 문제없음

-- alert
Errors in file /oracle12/app/oracle/diag/rdbms/db1/db1/trace/db1_lgwr_7484.trc:
ORA-00313: open failed for members of log group 1 of thread 1
ORA-00312: online log 1 thread 1: '/oracle12/app/oracle/oradata/db1/redo01_2.log'
ORA-27037: unable to obtain file status
Linux-x86_64 Error: 2: No such file or directory
Additional information: 7

5. 물리적으로 삭제된 멤버를 논리적으로 삭제하여 복구
alter database drop logfile member '/oracle12/app/oracle/oradata/db1/redo01_2.log';

-- alert
ORA-01609: log 1 is the current log for thread 1 - cannot drop members
ORA-00312: online log 1 thread 1: '/oracle12/app/oracle/oradata/db1/redo01.log'
ORA-00312: online log 1 thread 1: '/oracle12/app/oracle/oradata/db1/redo01_2.log'

=> current 상태인 그룹의 멤버를 삭제하는 것은 불가능
		=> logswitch 후, 삭제 재시도
		
6. 물리적, 논리적으로 삭제된 멤버를 다시 복구
alter database add logfile member '/oracle12/app/oracle/oradata/db1/redo01_2.log' to group 1;
```




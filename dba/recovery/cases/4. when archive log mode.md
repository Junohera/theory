[toc]

# When archive log mode

> archive log mode ì„ í–‰

## Setting

### 1. noarchive log mode to archive log mode

```sql
startup mount;
alter database archivelog;
alter database open;
archive log list
```

### 2. ë¶ˆí•„ìš”í•œ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ì •ë¦¬ ë° ìƒˆë¡œìš´ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ìƒì„±

```sql
select * from dba_tablespaces;
select * from dba_data_files;

drop tablespace test1;
drop tablespace test1 including contents;

create tablespace test2
         datafile '/oracle12/app/oracle/oradata/db1/test2_01.dbf' size 10m;
```

### 3. offline full bakcup

### ---

## Cases

|   no | archive log mode | Damage information | recently Redolog(SCN) | available offline | trouble shooting   |
| ---: | ---------------- | ------------------ | --------------------- | ----------------- | ------------------ |
|    1 | Yes              | normal tablespace  |                       | No                | recover tablespace |
|    2 | Yes              | normal tablespace  |                       | Yes               |                    |

### 1. ì¼ë°˜ tablespaceì˜ datafile ì†ìƒ(when archivelogmode)

```sql
0. ìƒí™© ì œì‘
create table arch_test1(no number) tablespace test2;

insert into arch_test1 values(1);
commit;

alter system switch logfile;		-- 4ë²ˆ

insert into arch_test1 values(2);
commit;

alter system switch logfile;		-- 4ë²ˆ

insert into arch_test1 values(3);
commit;

alter system switch logfile;

ğŸ’¥
!rm '/oracle12/app/oracle/oradata/db1/test2_01.dbf'

âœ… ë³µêµ¬ ìˆ˜í–‰
1. í•´ë‹¹ tablespace offline ì‹œë„
SQL> alter tablespace test2 offline;ğŸ’¥
alter tablespace test2 offline
*
ERROR at line 1:
ORA-01116: error in opening database file 6
ORA-01110: data file 6: '/oracle12/app/oracle/oradata/db1/test2_01.dbf'
ORA-27041: unable to open file
Linux-x86_64 Error: 2: No such file or directory
Additional information: 3

=> dirty bufferì— ëŒ€í•œ checkpointê°€ ë°œìƒí•  ê²½ìš°, offline ë¶ˆê°€í•  ìˆ˜ ìˆìŒ
offlineì´ ì•ˆë˜ëŠ” ê²½ìš°, DBê°€ ë‚´ë ¤ê°„ ìƒíƒœì—ì„œ ë³µêµ¬
(ìš´ì˜ì¤‘ì¼ ê²½ìš°, DBë¥¼ ê·¸ëŒ€ë¡œ ë‘ê³  copyDBë¥¼ í†µí•´ ì§„í–‰í•˜ì§€ë§Œ, ì—¬ì•„ì§ ê·¸ë ‡ê²Œê¹Œì§€ëŠ” í•˜ì§€ì•Šê¸°ë¡œ!!)

2. shutdown immediate
SQL> shutdown immediateğŸ’¥
ORA-01116: error in opening database file 6
ORA-01110: data file 6: '/oracle12/app/oracle/oradata/db1/test2_01.dbf'
ORA-27041: unable to open file
Linux-x86_64 Error: 2: No such file or directory
Additional information: 3

3. physical restore
cd /oracle12/app/oracle/oradata/db1
cp /opt/backup4oracle12/backup_202307261044/test2_01.dbf ./

4. shutdown abort

5. try startup mount
SQL> startup mount;

5. try complete recovery(only tablespace) âœ…
SQL> @arch_check
SQL> recover tablespace test2;
```

**ë³µêµ¬ì‹œ seqì •ë³´ì™€ scn ì •ë³´ë¥¼ í™•ì¸í•˜ì—¬ suggestion archive fileê³¼ ì‹¤ì œ archive fileì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì—¬**
**ì§„í–‰í•˜ë„ë¡í•œë‹¤.**

**ì˜ˆì‹œ ì´ë¯¸ì§€**

<img src="./assets/image-20230726111712139.png" alt="image-20230726111712139" style="zoom: 33%;" />

<img src="./assets/image-20230726111924930.png" alt="image-20230726111924930" style="zoom: 33%;" />

```sql
6. try open
alter database open;
```

### 2. 

```sql
0. ìƒí™© ì œì‘
create table arch_test2(no number) tablespace test2;

insert into arch_test2 values(1);
commit;

alter system switch logfile;		-- 4ë²ˆ

insert into arch_test2 values(2);
commit;

alter system switch logfile;		-- 4ë²ˆ

insert into arch_test2 values(3);
commit;

alter system checkpoint;

alter system switch logfile;

ğŸ’¥
!rm '/oracle12/app/oracle/oradata/db1/test2_01.dbf'

âœ… ë³µêµ¬ ìˆ˜í–‰
1. í•´ë‹¹ tablespace offline ì‹œë„
SQL> alter tablespace test2 offline;
alter tablespace test2 offline

2. physical restore
cd /oracle12/app/oracle/oradata/db1
cp /opt/backup4oracle12/backup_202307261044/test2_01.dbf ./

3. complete recovery(only tablespace) âœ…
SQL> @arch_check
SQL> recover tablespace test2;
...
Media recovery complete.

4. í•´ë‹¹ tablespace online ì‹œë„
SQL> alter tablespace test2 online;
Tablespace altered.

SQL> select tablespace_name, status from dba_tablespaces;

5. tablespace ìƒíƒœì¡°íšŒ
TABLESPACE_NAME                STATUS
------------------------------ ---------
SYSTEM                         ONLINE
SYSAUX                         ONLINE
UNDOTBS1                       ONLINE
TEMP                           ONLINE
USERS                          ONLINE
TEST2                          ONLINE

```

